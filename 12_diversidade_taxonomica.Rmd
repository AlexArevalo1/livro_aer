# Diversidade Taxon√¥mica {#cap12}

### Pr√©-requisitos do cap√≠tulo {.unnumbered}

```{r}
## Pacotes
library(devtools)
# install_github("paternogbc/ecodados") # para instalar o ecodados
library(ecodados)
library (vegan)
library(ggplot2)
library(BiodiversityR)
library(hillR)
library(betapart)

## Dados necess√°rios
composicao_especies <- ecodados::composicao_anuros_div_taxonomica
precipitacao        <- ecodados::precipitacao_div_taxonomica
```

## Aspectos te√≥ricos

A diversidade biol√≥gica √© um conceito multifacetado que pode ser
definido e analisado de diferentes maneiras (e.g. diversidade gen√©tica,
taxon√¥mica, funcional, filogen√©tica, ecossist√™mica, etc.)[@magurran_biological_2011;
@gotelli2013]. Whittaker [-@whittaker1960; -@whittaker1972] particionou
a diversidade em tr√™s componentes: i) diversidade alfa que √©
caracterizada pela diversidade dentro do habitat ou unidade amostral;
ii) diversidade beta que √© caracterizada pela varia√ß√£o na diversidade
entre habitats ou unidades amostrais; e iii) diversidade gama que √©
caracterizada pela combina√ß√£o da diversidade alfa e beta ou definida
como a diversidade regional englobando todos os habitats ou unidades
amostrais. Portanto, n√£o existe um m√©todo que quantifique todos os
par√¢metros associados √† diversidade biol√≥gica. Consequentemente, a
escolha da m√©trica de diversidade depender√° i) do objetivo do estudo; e
ii) das informa√ß√µes dispon√≠veis para o pesquisador.

Neste cap√≠tulo, iremos abordar a diversidade taxon√¥mica que ignora a
rela√ß√£o de parentesco entre as esp√©cies (e.g. diversidade filogen√©tica -
\@ref[cap13]) e as diferentes fun√ß√µes que as esp√©cies realizam no
ecossistema (e.g. diversidade funcional - \@ref[cap14]). Na diversidade
taxon√¥mica, pesquisadores est√£o interessados na riqueza de esp√©cies
(e.g. n√∫mero de esp√©cies), na distribui√ß√£o de abund√¢ncia das esp√©cies
(e.g. fato que algumas esp√©cies s√£o comuns e outras raras) e/ou
diversidade de esp√©cies (e.g. √≠ndices que descrevem a rela√ß√£o entre a
riqueza e a distribui√ß√£o da abund√¢ncia relativa das esp√©cies) nas
localidades.

## Diversidade alfa

### Riqueza de esp√©cies ou n√∫mero de esp√©cies

Riqueza de esp√©cies √© uma m√©trica intuitiva e de f√°cil compreens√£o, uma
vez que se refere ao n√∫mero de esp√©cies observadas em uma localidade. √â
importante ter em mente que a riqueza de esp√©cies √© influenciada pelo
esfor√ßo amostral e sua estimativa real √© um imenso desafio
[@magurran_biological_2011]. Compara√ß√µes entre comunidades com diferen√ßas no n√∫mero
de amostragens ou abund√¢ncia das esp√©cies devem ser realizadas por meio
de rarefa√ß√µes (veja \@ref[cap10]), enquanto que o n√∫mero de esp√©cies n√£o
detectadas pode ser estimado pelos estimadores de riqueza (veja
\@ref[cap11]). Embora raramente usados como alternativa a rarefa√ß√£o,
existem alguns √≠ndices que calculam a riqueza de esp√©cies ponderando a
abund√¢ncia total (i.e. tamanho da amostra) dentro de cada comunidade.
Esses √≠ndices s√£o:

> **√çndice de Margalef**
>
> $$D_{Mg} = \frac{S-1}{ln (N)}$$
>
> onde:
>
> -   S = o n√∫mero de esp√©cies na comunidade;
>
> -   ln = logaritmo natural;
>
> -   N = n√∫mero total de indiv√≠duos na comunidade;
>
> -   D~Mg~ n√£o tem um valor m√°ximo e sua interpreta√ß√£o √© comparativa,
>     com valores maiores indicando maior riqueza de esp√©cies.

e

> **√çndice de Menhinick**
>
> $$D_{Mn} = \frac{S}{\sqrt{N}}$$
>
> onde:
>
> -   S = o n√∫mero de esp√©cies na comunidade;
>
> -   N = n√∫mero total de indiv√≠duos na comunidade;
>
> -   D~Mn~ n√£o tem um valor m√°ximo e sua interpreta√ß√£o √© comparativa,
>     com valores maiores indicando maior riqueza de esp√©cies.

#### Exemplo pr√°tico 1 - Riqueza de esp√©cies

**Explica√ß√£o dos dados**

Neste exemplo, avaliaremos a riqueza de esp√©cies de 10 comunidades. Os
dados de ocorr√™ncia das esp√©cies nas comunidades foram simulados para
demonstrar as propriedades das m√©tricas de diversidade taxon√¥micas.
Utilizaremos este conjunto de dados para todos os exemplos deste
cap√≠tulo.

**Pergunta:**

> A varia√ß√£o espacial na riqueza de esp√©cies nas comunidades est√°
> associada com a varia√ß√£o na precipita√ß√£o?

**Predi√ß√µes**

> Os valores de riqueza de esp√©cies ser√£o maiores nas comunidades
> localizadas em regi√µes que recebem grande volume de precipita√ß√£o do
> que em regi√µes mais secas.

**Vari√°veis**

-   Vari√°veis resposta e preditoras

    -   Dataframe com as comunidades (unidade amostral) nas linhas e as
        esp√©cies (vari√°vel resposta) nas colunas.
    -   Dataframe com as comunidades (unidade amostral) nas linhas e
        precipita√ß√£o anual (vari√°vel preditora) na coluna.

**Checklist**

-   Verificar se os dataframes de composi√ß√£o de esp√©cies e vari√°veis
    ambientais est√£o com as unidades amostrais nas linhas e vari√°veis
    preditores nas colunas.

-   Verificar se as comunidades nos dataframes de composi√ß√£o de esp√©cies
    e vari√°veis ambientais est√£o distribu√≠dos na mesma sequ√™ncia/ordem
    nos dois arquivos.

Abaixo demonstramos os c√≥digos no R para determinar a riqueza de
esp√©cies para cada comunidade a partir da planilha de composi√ß√£o de
esp√©cies. Os dados est√£o dispon√≠veis no pacote `ecodados.`

```{r}
# Ver os dados das comunidades
head(composicao_especies)
```

Vamos ver a riqueza de esp√©cies para cada comunidade.

```{r}
# Calculando a riqueza observada de esp√©cies para cada comunidade.
(riqueza_sp <- specnumber(composicao_especies))
```

Vamos ver a abund√¢ncia total de cada comunidade.

```{r}
# Calculamos a abund√¢ncia total para cada comunidade. 
(abundancia <- apply(composicao_especies, 1, sum))
```

Calculando o √çndice de Margalef.

```{r}
# A fun√ß√£o round √© para limitar o resultado para duas casas decimais.
(Margalef <- round((riqueza_sp-1)/log(abundancia), 2))
```

Calculando o √çndice de Menhinick.

```{r}
(Menhinick <- round(riqueza_sp/sqrt(abundancia), 2))
```

Agora vamos analisar a rela√ß√£o entre a riqueza de esp√©cies e a
precipita√ß√£o anual.

```{r}
# Juntando todos os dados em um √∫nico dataframe.
dados <- data.frame(precipitacao$prec, riqueza_sp, Margalef, Menhinick)

# Renomenado as colunas
colnames(dados) <- c("Precipitacao", "Riqueza", "Margalef", "Menhinick")

# Riqueza de esp√©cies e precipita√ß√£o
anova(lm(dados$Riqueza ~ dados$Precipitacao))
```

H√° uma rela√ß√£o positiva entre a riqueza de esp√©cies e a precipita√ß√£o
anual (F~1,8~ = 8,91, P = 0,01).

Rela√ß√£o entre o √çndice de Margalef e a precipita√ß√£o anual.

```{r}
anova(lm(dados$Margalef ~ dados$Precipitacao))
```

N√£o h√° uma rela√ß√£o positiva entre o √≠ndice de Margalef e a precipita√ß√£o
anual (F~1,8~ = 2,12, P = 0,18).

Agora vamos analisar a rela√ß√£o entre a riqueza de esp√©cies e a
precipita√ß√£o anual.

```{r}
anova(lm(dados$Menhinick ~ dados$Precipitacao))
```

N√£o h√° uma rela√ß√£o positiva entre o √≠ndice de Menhinick e a precipita√ß√£o
anual (F~1,8~ = 1,09, P = 0,32).

Vamos plotar o gr√°fico com os resultados da riqueza de esp√©cies ao longo
do gradiente de precipita√ß√£o anual.

```{r}
ggplot(data = dados, aes(x= Precipitacao, y= Riqueza)) + 
  labs(x = "Precipita√ß√£o anual (mm)", y = "Riqueza de esp√©cies") +
  geom_point(size = 4, shape = 21, fill = "darkorange", alpha = 0.7) +
  tema_livro() +
  geom_smooth(method = lm, se = FALSE, color = "black") 
```

**Interpreta√ß√£o dos resultados**

Percebam que ponderar a riqueza de esp√©cies pela abund√¢ncia altera a
interpreta√ß√£o dos resultados. O n√∫mero de esp√©cies √© maior em comunidades com maior precipita√ß√£o. Contudo, quando poderamos pela abund√¢ncia (√≠ndices de Margalef ou Menhinick), a rela√ß√£o com a precipita√ß√£o n√£o √© significativa.


## Diversidade de esp√©cies

Diferente dos √≠ndices de riqueza de esp√©cies que n√£o levam em
considera√ß√£o a abund√¢ncia relativa das esp√©cies (i.e. todas as esp√©cies
tem o mesmo peso), os √≠ndices de diversidade avaliam al√©m da riqueza, a
domin√¢ncia ou raridade das esp√©cies nas comunidades. Assim, quando
comparamos duas comunidades com a mesma riqueza de esp√©cies, e uma das
comunidades √© dominada por uma √∫nica esp√©cie e a outra comunidade
apresenta esp√©cies com abund√¢ncias parecidas, consideramos a segunda
comunidade mais diversa. Os √≠ndices de diversidade variam porque eles
d√£o pesos diferentes para a riqueza e equitabilidade das esp√©cies.
Assim, um determinado √≠ndice de diversidade pode indicar que uma
comunidade X √© mais diversa que Y, enquanto outro √≠ndice indica o oposto
[@melo2008]. Portanto, uma maneira de determinar qual √≠ndice de
diversidade usar √© saber se voc√™ quer dar maior peso para riqueza ou
equitabilidade das esp√©cies nas comunidades. 

::: {.alert .alert-info}
<strong> üìù Importante: </strong> Ressaltamos que h√°
v√°rias cr√≠ticas em rela√ß√£o ao uso dos √≠ndices de diversidade que s√£o
abstratos e dif√≠ceis de se interpretar [@hurlbert1971]. Por exemplo,
dizer que o valor X estimado por √≠ndices de diversidade √© alto ou baixo
√© irrelevante se n√£o tivermos uma base comparativa (para mais detalhes
veja Melo 2008).
:::

Os dois √≠ndices de diversidade mais usados na ecologia s√£o:

> **√çndice de Shannon-Wiener** - quantifica a incerteza associada em
> predizer a identidade de uma esp√©cie dado o n√∫mero de esp√©cies e a
> distribui√ß√£o de abund√¢ncia para cada esp√©cie. Este √≠ndice √© mais
> sens√≠vel a mudan√ßas nas esp√©cies raras da comunidade.
>
> $$H' = -\sum_{i=1}^{S}p_i * ln p_i$$
>
> onde:
>
> -   p~i~ = abund√¢ncia relativa de cada esp√©cie, calculada pela
>     propor√ß√£o dos indiv√≠duos de uma esp√©cie pelo n√∫mero total dos
>     indiv√≠duos na comunidade;
>
> -   ln = logaritmo natural, mas outras bases logar√≠tmas podem ser
>     utilizadas;
>
> -   H' n√£o tem um valor m√°ximo e sua interpreta√ß√£o √© comparativa, com
>     valores maiores indicando maior diversidade.

e

> **√çndice de Simpson** - quantifica a probabilidade de dois indiv√≠duos
> retirados ao acaso da comunidade pertencerem a mesma esp√©cie. Este
> √≠ndice √© na verdade uma medida de domin√¢ncia. Assim, como a
> probabilidade dos indiv√≠duos serem da mesma esp√©cie diminui com o
> aumento da riqueza de esp√©cies, o √≠ndice de Simpson tamb√©m diminui com
> a riqueza.
>
> $$D = \sum_{i=1}^{S}p_i^2$$
>
> onde:
>
> -   P~i~ = abund√¢ncia relativa de cada esp√©cie, calculada pela
>     propor√ß√£o dos indiv√≠duos de uma esp√©cie pelo n√∫mero total dos
>     indiv√≠duos na comunidade.
>
> -   D varia de 0 a 1 com valores pr√≥ximos de 1 indicando menor
>     diversidade enquanto valores pr√≥ximos de 0 indicam maior
>     diversidade. Para evitar confus√£o nas interpreta√ß√µes, normalmente
>     o √≠ndice de Simpson √© expressado como o valor inverso (1 - D) para
>     que os maiores valores representem maior diversidade. Neste caso,
>     o valor inverso √© conhecido na literatura como √≠ndice
>     Gini-Simpson. Para o √≠ndice Gini-Simpson estamos avaliando a
>     probabilidade de dois indiv√≠duos retirados ao acaso da comunidade
>     sejam de esp√©cies diferentes.

#### Exemplo pr√°tico 2 - Diversidade de esp√©cies

**Explica√ß√£o dos dados**

Usaremos os mesmos dados simulados do exemplo pr√°tico 1.

**Pergunta:**

> A varia√ß√£o espacial na diversidade de esp√©cies das comunidades est√°
> associado com o gradiente de precipita√ß√£o?

**Predi√ß√µes**

> Os valores de diversidade de esp√©cies ser√£o maiores nas comunidades
> localizadas em regi√µes maior volume de precipita√ß√£o do que em regi√µes
> mais secas.

Abaixo demonstramos os comandos no R para determinar a diversidade de
esp√©cies para cada comunidade a partir da planilha de composi√ß√£o de
esp√©cies.

```{r}
# MARGIN = 1 significa que a fun√ß√£o ir√° calcular o √≠ndice considerando 
# as linhas do data.frame (comunidades).
shannon_res <- diversity(composicao_especies, 
                         index = "shannon", MARGIN = 1)
shannon_res
```

O argumento `index = "simpson"`, calcula o √≠ndice Gini-Simpson (1-D).

```{r}
simpson_res <- diversity(composicao_especies, 
                         index = "simpson", MARGIN = 1) 
simpson_res
```

**Interpreta√ß√£o dos resultados**

A comunidade 1 foi a comunidade que apresentou a maior diversidade de
esp√©cies, enquanto a comunidade 2 foi a comunidade que apresentou a
menor diversidade. Gostar√≠amos de chamar a aten√ß√£o para a import√¢ncia da
distribui√ß√£o da abund√¢ncia relativa das esp√©cies dentro das comunidades.
Percebam que tanto a comunidade 1 quanto a comunidade 2 abrigam o mesmo
n√∫mero de esp√©cies (10 esp√©cies) e abund√¢ncia total (100 indiv√≠duos),
mas o padr√£o de distribui√ß√£o da abund√¢ncia relativa entre as esp√©cies
dentro das comunidades s√£o bem discrepantes. Na comunidade 1 as esp√©cies
apresentam abund√¢ncias semelhantes entre elas (i.e. alta
equitabilidade), enquanto que na comunidade 2 uma esp√©cie √© dominante e
as outras raras (i.e. baixa equitabilidade). Essa diferen√ßa na
distribui√ß√£o da abund√¢ncia relativa entre as comunidades √© um fator
muito importante para os √≠ndices de diversidade. Dentro desta
perspectiva, alguns √≠ndices fornecem uma estimativa sobre a
equitabilidade da distribui√ß√£o da abund√¢ncia nas comunidades. Entre
eles, o mais conhecido foi proposto por Pielou [-@pielou1966]:

> **√çndice de Equabilidade (ou Equitabilidade) de Pielou** √© uma m√©trica
> derivada do √≠ndice de Shannon-Wiener que descreve o padr√£o de
> distribui√ß√£o da abund√¢ncia relativa das esp√©cies na comunidade.
>
> $$J = \frac{H'}{Hmax} = \frac{H'}{ln (S)}$$
>
> onde:
>
> -   H' = √≠ndice de Shannon-Wiener;
> -   H~max~ = todas as esp√©cies teriam a mesma abund√¢ncia relativa.
>     H~max~ √© calculado aplicando o logaritmo natural (ln) para a
>     riqueza de esp√©cies (S);
> -   Se todas as esp√©cies apresentam a mesma abund√¢ncia relativa, ent√£o
>     J = 1. Se uma esp√©cie apresenta forte domin√¢ncia, J aproxima-se de
>     zero.

N√£o h√° uma fun√ß√£o no R que calcule o √≠ndice de Pielou, mas ele pode
facilmente ser calculado usando os valores de diversidade de Shannon e o
logaritmo da riqueza de esp√©cies de cada comunidade

```{r}
(Pielou <- shannon_res/log(specnumber(composicao_especies)))
```

Agora que temos uma ideia de como a riqueza de esp√©cies e a distribui√ß√£o
da abund√¢ncia relativa s√£o importantes para quantificar os valores dos
√≠ndices de diversidade, vamos testar se h√° rela√ß√£o entre os √≠ndices de
diversidade e precipita√ß√£o anual nas comunidades.

```{r}
# Juntando todos os dados em um √∫nico dataframe.
dados_div <- data.frame(precipitacao$prec, shannon_res, 
                        simpson_res, Pielou)

# Renomeando as colunas
colnames(dados_div) <- c("Precipitacao", "Shannon", 
                         "Simpson", "Pielou")
```

Regress√£o simples para verificar a rela√ß√£o entre o √≠ndice de
Shannon-Wiener e a precipita√ß√£o anual nas comunidades.

```{r}
anova(lm(dados_div$Shannon ~ dados_div$Precipitacao))
```

Regress√£o simples para verificar a rela√ß√£o entre o √≠ndice de Simpson e a
precipita√ß√£o anual nas comunidades.

```{r}
anova(lm(dados_div$Simpson ~ dados_div$Precipitacao))
```

Regress√£o simples para verificar a rela√ß√£o entre o √≠ndice de Pielou e a
precipita√ß√£o anual nas comunidades.

```{r}
anova(lm(dados_div$Pielou ~ dados_div$Precipitacao))
```

::: {.alert .alert-info}
<strong> üìù Importante: </strong> As an√°lises acima s√£o apenas
ilustrativas. N√£o estamos avaliando as premissas de normalidade e
homogeneidade da vari√¢ncia dos res√≠duos (veja \@ref[cap7]).
:::

**Interpreta√ß√£o dos resultados**

A varia√ß√£o espacial na diversidade de esp√©cies, obtida atrav√©s dos
√≠ndices de Shannon-Wiener e Simpson, e a equitabilidade de Pielou n√£o
foram associados com a varia√ß√£o na precipita√ß√£o anual entre as √°reas (P
\> 0,05).

## Diagramas de Whittaker ou Curva de Domin√¢ncia

Embora os √≠ndices de diversidade de esp√©cies englobem os componentes
riqueza e abund√¢ncia relativa das esp√©cies nas suas estimativas, n√£o √©
poss√≠vel conhecer o n√∫mero de esp√©cies ou quais s√£o as esp√©cies
dominantes ou raras dentro das comunidades. Por exemplo, duas
comunidades podem ter o mesmo valor de diversidade e ainda assim
apresentar diferen√ßas na riqueza e equitabilidade (Melo 2008). O
diagrama de Whittaker √© um m√©todo que lida com essas quest√µes utilizando
informa√ß√µes visuais do n√∫mero de esp√©cies e abund√¢ncia relativa de cada
esp√©cie nas comunidades. Este m√©todo plota as esp√©cies ranqueadas no
eixo X da mais abundante para a menos abundante, enquanto que no eixo Y
as abund√¢ncias relativas das esp√©cies s√£o plotadas em escala logaritma
(log~10~). Este gr√°fico permite ao leitor reconhecer: i) a riqueza de
esp√©cies observando o eixo X, ii) a equitabilidade da abund√¢ncia
relativa das esp√©cies pela inclina√ß√£o da reta; e iii) quais s√£o as
esp√©cies dominantes, intermedi√°rias e raras nas comunidades atrav√©s da
observa√ß√£o em rela√ß√£o ao eixo Y. A partir destas curvas, v√°rios autores
propuseram modelos matem√°ticos para explicar a distribui√ß√£o de
abund√¢ncia das esp√©cies gerando diferentes modelos te√≥ricos (e.g. s√©rie
geom√©trica, *broken-stick*, log-series e log-normal). Cada modelo possui
predi√ß√µes distintas: o modelo geom√©trico prediz distribui√ß√£o de
abund√¢ncias desiguais, *broken-stick* prediz distribui√ß√£o de abund√¢ncias
uniformes, enquanto log-normal e log-series s√£o intermedi√°rias com
predi√ß√µes distintas sobre as propor√ß√µes de esp√©cies raras - alta em
log-series, baixa em log-normal (veja McGill et al. [-@mcgill2007] para
revis√£o).

Para an√°lises explorat√≥rias onde voc√™ tem interesse em visualizar o
padr√£o da distribui√ß√£o relativa das esp√©cies por comunidade, a fun√ß√£o
`rankabundance` do pacote *BiodiversityR* √© uma op√ß√£o interessante.

```{r}
# c√°lculo da curva para as comunidades 2 e 3.
rank_com2 <- rankabundance(composicao_especies[2, composicao_especies[2,] > 0])
rank_com3 <- rankabundance(composicao_especies[3, composicao_especies[3,] > 0])

# Gr√°fico 
# Veja a ajuda da fun√ß√£o rankabundplot para outros exemplos de gr√°ficos.
rankabunplot(rank_com2, scale = "logabun", specnames = c(1), pch = 19, 
             col = "darkorange")
rankabunplot(rank_com3, scale = "logabun", specnames = c(1), pch = 19, 
             xlim = c(0,10), addit = T, col = "cyan4" , legend = T)
legend(5, 40, legend = c("Comunidade 2", "Comunidade 3"),
       col = c("darkorange", "cyan4"), lty = 1, cex = 0.8, box.lty = 0)
```

**Interpreta√ß√£o dos resultados**

Percebam que olhando os eixos do gr√°fico conseguimos determinar que a
comunidade 2 (c√≠rculo laranja) abriga 10 esp√©cies no total (i.e.
comprimento do eixo X), com a esp√©cie sp1 apresentando alta domin√¢ncia e
as outras esp√©cies apresentando abund√¢ncias muito baixas. A comunidade 3
(c√≠rculo ciano) abriga cinco esp√©cies no total, sendo que a esp√©cie sp4
apresenta alta domin√¢ncia, duas esp√©cies apresentam abund√¢ncias
intermedi√°rias e outras duas abund√¢ncias baixas.

## Curvas de distribui√ß√£o de abund√¢ncias

Caso o interesse seja avaliar qual dos modelos te√≥ricos melhor explica a
distribui√ß√£o das abund√¢ncias das esp√©cies, a fun√ß√£o `radift` do pacote
*vegan* √© a melhor op√ß√£o.

::: {.alert .alert-info}
A fun√ß√£o `radfit` avalia cinco modelos te√≥ricos para determinar qual
deles melhor se ajustam aos dados. Os modelos te√≥ricos avaliados na
fun√ß√£o s√£o:

-   Null = modelo broken-stick;

-   preemption = s√©rie geom√©trica;

-   log-normal;

-   Zipf;

-   Zipf-Mandelbrot.
:::

Voc√™ pode realizar as an√°lises separadamente para cada comunidade ou
para todas as comunidades ao mesmo tempo.

Vamos come√ßar avaliando separadamente a comunidade 2.

```{r}
curvas_dominancia_com2 <- radfit(composicao_especies[2,])
curvas_dominancia_com2
```

Agora vamos fazer um gr√°fico com as predi√ß√µes dos modelos

```{r}
plot(curvas_dominancia_com2, ylab = "Abund√¢ncia", 
     xlab = "Ranqueamento das esp√©cies")
```

**Interpreta√ß√£o dos resultados**

Os pontos brancos representam as esp√©cies ranqueadas de acordo com a
abund√¢ncia e as linhas representam as predi√ß√µes dos modelos mat√©maticos.
Com base nos valores de AIC (veja Cap√≠tulo 7), o Zipf √© o melhor modelo
explicando a distribui√ß√£o da abund√¢ncia relativa das esp√©cies na
comunidade 2.

Agora vamos analisar os dados considerando todas as comunidades.

```{r}
curvas_dominancia_todas <- radfit(composicao_especies)
curvas_dominancia_todas

# Vamos fazer um gr√°fico para cada comunidade
plot(curvas_dominancia_todas, log = "y")
```

**Interpreta√ß√£o dos resultados**

A comunidade 1 foi associada com o modelo log-normal, as comunidades 2 e
4 com o modelo Zipf, a comunidade 3 com o modelo s√©rie geom√©trica e as
outras comunidades com o modelo nulo. Para explorar a explica√ß√£o
biol√≥gica por tr√°s destes modelos veja os artigos [@wilson1991;
@mcgill2007; @magurran_biological_2011]. Contudo, esse link entre o modelo
matem√°tico e a explica√ß√£o biol√≥gica precisa ser interpretado com cuidado
porque diferentes modelos matem√°ticos podem levar ao mesmo padr√£o de
distribui√ß√£o de abund√¢ncia.

## N√∫meros de Hill ou S√©rie de Hill

Embora os √≠ndices de Shannon-Wiener e Gini-Simpson sejam amplamente
usados em estudos ecol√≥gicos e de conserva√ß√£o, eles sofrem de
propriedades matem√°ticas e n√£o representam a diversidade propriamente
dita [@jost2006]. Portanto, quando o objetivo √© avaliar a diversidade,
os √≠ndices de Shannon-Wiener e Gini-Simpson n√£o deveriam ser utilizados
na sua forma padr√£o, mas transformados em n√∫meros efetivos de esp√©cies
ou diversidade verdadeira [@jost2006]. O n√∫mero efetivo de esp√©cies √© o
n√∫mero de esp√©cies igualmente abundantes (i.e. todas as esp√©cies com a
mesma abund√¢ncia) necess√°rias para produzir o valor observado para um
determinado √≠ndice. Por exemplo, uma comunidade com √≠ndice de
Shannon-Wiener estimado de 4,5 teria um n√∫mero efetivo de 90 esp√©cies
igualmente abundantes. Jost et al. (2006) usam o seguinte exemplo para
explicar o conceito do n√∫mero efetivo de esp√©cies - uma comunidade com
16 esp√©cies igualmente abundantes √© duas vezes mais diversa do que uma
comunidade com 8 esp√©cies igualmente abundantes. Neste caso, a
diversidade deveria ser proporcional ao n√∫mero de esp√©cies. Contudo,
quando aplicamos os √≠ndices de diversidade para estas comunidades com 16
e 8 esp√©cies (cada esp√©cie com 5 indiv√≠duos), o √≠ndice de Shannon-Wiener
√© 2,772 e 2,079 respectivamente, e o √≠ndice de Gini-Simpson √© 0,937 e
0,875 respectivamente. Claramente, os valores estimados pelos √≠ndices de
diversidade n√£o representam a diferen√ßa entre as comunidades porque eles
carecem de uma particularidade matem√°tica conhecida como propriedade de
duplica√ß√£o. O pr√≥ximo exemplo (modificado do website de Lou Jost;
[http://www.loujost.com/](http://www.loujost.com/Statistics%20and%20Physics/Diversity%20and%20Similarity/EffectiveNumberOfSpecies.htm))
demostra a import√¢ncia da transforma√ß√£o dos √≠ndices de diversidade em
n√∫meros efetivos de esp√©cies. Imagine que voc√™ foi contratado para
avaliar a diversidade de peixes em um riacho antes e depois da
instala√ß√£o de uma usina hidrel√©trica. Suponha que os valores estimados
pelo √≠ndice de Gini-Simpson foi de 0,99 antes da instala√ß√£o e de 0,97
depois da instala√ß√£o. A princ√≠pio, voc√™ poderia concluir que a
diversidade diminuiu somente 2% e que a instala√ß√£o da hidrel√©trica n√£o
afetou a diversidade de peixes no riacho. Contudo, transformando os
valores do √≠ndice de diversidade em n√∫meros efetivos, percebemos que
antes da instala√ß√£o a diversidade do riacho equivale a 100 esp√©cies
igualmente abundantes enquanto ap√≥s a instala√ß√£o, equivale a 33 esp√©cies
igualmente abundantes. Portanto, a queda da diversidade √© 66% e n√£o 2%.

> Hill [-@hill1973] derivou uma equa√ß√£o geral para o c√°lculo do n√∫mero
> efetivo de esp√©cies ou diversidade verdadeira que depende apenas do
> valor de *q* e da abund√¢ncia relativa das esp√©cies:
>
> $$^qD = (\sum_{i=1}^{S}p_i^q)^{1/(1-q)}$$
>
> Onde:
>
> q = √© um par√¢metro conhecido como ordem da diversidade e √© usado para
> dar peso as esp√©cies comuns ou raras. q = 0 n√£o considera a frequ√™ncia
> das esp√©cies e representa a riqueza observada de esp√©cies; q = 1
> equivale a transforma√ß√£o do √≠ndice de Shannon-Wiener (i.e. exp(H')) e
> da peso as esp√©cies com base na propor√ß√£o das suas frequ√™ncias; q = 2
> equivale a transforma√ß√£o do √≠ndice de Gini-Simpson (i.e. 1/(1-D)) e da
> peso as esp√©cies mais comuns. Valores de q \<1 favorecem esp√©cies
> raras enquanto valores de q \> 1 favorecem esp√©cies comuns.
>
> p~i~ = abund√¢ncia relativa de cada esp√©cie, calculada pela propor√ß√£o
> dos indiv√≠duos de uma esp√©cie pelo n√∫mero total dos indiv√≠duos na
> comunidade.

Vamos calcular o n√∫mero de Hill para as comunidades do nosso exemplo.

Calculando o N√∫mero de Hill com q = 0.

```{r}
(hill_res_q_0 <- hill_taxa(composicao_especies, q  = 0))
```

Calculando o N√∫mero de Hill com q = 1.

```{r}
(hill_res_q_1 <- hill_taxa(composicao_especies, q  = 1))
```

Calculando o N√∫mero de Hill com q = 2.

```{r}
(hill_res_q_2 <- hill_taxa(composicao_especies, q  = 2))
```

Criando um data frame com os tr√™s resultados anteriores

```{r}
res_hill <- data.frame(hill_res_q_0, hill_res_q_1, hill_res_q_2)
colnames(res_hill) <- c("q=0", "q=1", "q=2")
head(res_hill)
```

**Interpreta√ß√£o dos resultados**

Como na comunidade 1 todas as esp√©cies s√£o igualmente abundantes,
alterar os valores de *q* n√£o altera o n√∫mero efetivo de esp√©cies que
permanece sempre 10. Contudo, na comunidade 2 que apresenta alta
domin√¢ncia de uma esp√©cie, alterar os valores de q diminui
consideravelmente a estimativa de diversidade. A vantagem dos n√∫meros de
Hill √© que eles s√£o de f√°cil interpreta√ß√£o e compara√ß√£o entre as
comunidades. Fator ausente para os √≠ndices de diversidade. Neste ponto,
esperamos que tenha ficado claro que mais do que a riqueza de esp√©cies,
a abund√¢ncia relativa das esp√©cies (e.g. comuns ou raras) tem um papel
fundamental na estimativa da diversidade de esp√©cies.

## Diversidade beta

O termo diversidade beta foi proposto por Whittker [-@whittaker1960] e
foi definido como a raz√£o entre a diversidade gama e diversidade alfa
(i.e. diversidade beta multiplicativa) quantificando n√£o s√≥ a rela√ß√£o
entre a diversidade regional e local, mas tamb√©m o grau de diferencia√ß√£o
entre as comunidades. Para demonstrar como a diversidade beta varia
entre comunidades locais dentro de uma regi√£o usaremos a explica√ß√£o do
Baselga
(<http://webspersoais.usc.es/persoais/andres.baselga/beta.html>).
Imagine tr√™s comunidades, cada comunidade abrigando as mesmas cinco
esp√©cies. Neste caso, a m√©dia da diversidade alfa = 5, a diversidade
gama = 5 e a raz√£o entre elas (gama/alfa) indica uma diversidade beta =
1. Isso significa que na regi√£o existe apenas uma unidade distinta de
composi√ß√£o. Quando a composi√ß√£o de esp√©cies das tr√™s comunidades √©
completamente diferente (i.e. diferencia√ß√£o m√°xima), temos que a m√©dia
da diversidade alfa = 5, a diversidade gama = 15 e a raz√£o entre elas
indica uma diversidade beta = 3. Neste caso, existem tr√™s unidades
distintas dentro da regi√£o. Assim, a diversidade beta multiplicativa
varia de 1 at√© o n√∫mero de comunidades dentro da regi√£o. A maioria dos
√≠ndices de (dis)similaridade utilizadas na ecologia (e.g. √≠ndices de
Jaccard e S√∏rensen) s√£o √≠ndices que padronizam a diversidade beta e
geram valores independentes do n√∫mero de comunidades. Eles podem ser
calculados para dados de incid√™ncia (presen√ßa e aus√™ncia) ou abund√¢ncia
[@legendre_numerical_2012] e considerando compara√ß√µes par-a-par entre as
comunidades ou compara√ß√£o entre m√∫ltiplas comunidades (i.e.
multiple-site). Por muito tempo, os valores de (dis)similaridade foram
interpretados como sin√¥nimo de substitui√ß√£o de esp√©cies (turnover) entre
comunidades. Contudo, √≠ndices de (dis)similaridade como Jaccard e
S√∏rensen geram valores de (dis)similaridade para comunidades que n√£o
apresentam diferen√ßas na composi√ß√£o de esp√©cies, mas apresentam
diferen√ßas na riqueza de esp√©cies (i.e. comunidades aninhadas). Pensando
nestes fatores, Baselga [-@baselga2009, [-@baselga2012]] prop√¥s uma
abordagem que particiona a diversidade beta total em dois componentes: o
componente resultante da substitui√ß√£o de esp√©cies (turnover) e o
componente resultante do aninhamento (i.e. diferen√ßa na riqueza de
esp√©cies). Baselga [-@baselga2013] prop√¥s a a parti√ß√£o da diversidade
beta para √≠ndices de dissimilaridade que lidam com dados de abund√¢ncia.
Neste caso os componentes da diversidade beta s√£o chamados de varia√ß√£o
balanceada na abund√¢ncia (similar ao componente substitui√ß√£o de
esp√©cies) e gradiente de abund√¢ncia (similar ao componente aninhamento).
Reconhecer estes componentes da diversidade beta √© importante porque
eles apresentam padr√µes distintos (substitui√ß√£o de esp√©cies *vs* perda
ordenada de esp√©cies) que provavelmente est√£o sendo gerados por
processos ecol√≥gicos diferentes (Baselga 2010, 2012, 2013).

Aqui, vamos demonstrar alguns exemplos de como calcular a parti√ß√£o da
diversidade beta para os dados deste cap√≠tulo.

Para isso, primeiro vamos transformar nossa planilha de abund√¢ncia em
presen√ßa e aus√™ncia.

```{r}
# Transformando dados em presencia e aus√™ncia.
composicao_PA <- decostand(composicao_especies, method = "pa")
```

Calculando a diversidade beta par a par usando os dados de presen√ßa e
aus√™ncia.

```{r}
resultado_PA <- beta.pair(composicao_PA, index.family = "sorensen")
```

::: {.alert .alert-info}
A fun√ß√£o `beta.pair`gera tr√™s listas com matrizes triangulares:

-   **Diversidade beta total** = √≠ndice de Sorensen (beta.sor);

-   **Componente substitui√ß√£o de esp√©cies** = √≠ndice de Simpson
    (beta.sim);

-   **Componente aninhado** = beta.sor - beta.sim.
:::

Vamos olhar os resultados da diversidade beta total.

```{r}
resultado_PA$beta.sor
```

Vamos montar um data.frame com os resultados

```{r}
data.frame_PA <- data.frame(round(as.numeric(resultado_PA$beta.sor), 2),
                            round(as.numeric(resultado_PA$beta.sim), 2),
                            round(as.numeric(resultado_PA$beta.sne), 2))
colnames(data.frame_PA) <- c("Sorensen", "Simpson", "Aninhamento")
head(data.frame_PA)
```

::: {.alert .alert-info}
<strong> üìù Importante: </strong> Percebam que a primeira linha e
primeira coluna do data frame (i.e. 0.00) representa a dissimilaridade
de Sorensen entre a Com1 e Com2 (compare com os valores da matriz
triangular acima). As linhas subsequentes representam a dissimilaridade
da Com1 com todas as outras comunidades, depois da Com2 com todas as
comunidades e assim sucessivamente. Lembrem-se que os componentes,
subsitui√ß√£o (Simpson) e aninhamento, s√£o um desdobramento da diversidade
beta total (Sorensen). Assim, a soma da dissimilaridade de Simpson e
aninhamento √© igual ao valor de dissimilaridade de Sorensen
[@baselga2009; @baselga2012].
:::

Vamos calcular a dissimilaridade entre a precipita√ß√£o anual das
comunidades usando o √≠ndice de dist√¢ncia euclidiana. Vejam a ajuda da
fun√ß√£o `vegdist` que calcula 17 √≠ndices diferentes de dissimilaridade.

```{r}
prec_dis <- vegdist(precipitacao, method = "euclidian")
dados_prec <- as.numeric(prec_dis) 
```

Agora vamos juntar os resultados.

::: {.alert .alert-info}
<strong> üìù Importante: </strong> As comunidades devem estar dispostas na
mesma ordem nas duas planilhas (composi√ß√£o de esp√©cies e precipita√ß√£o) para que os resultados representem as
dissimilaridades par a par para as mesmas comunidades no data frame.
:::

Criando data.frame.

```{r}
dados_dis <- data.frame(dados_prec, data.frame_PA)
head(dados_dis)
```

Vamos testar a rela√ß√£o entre as diferen√ßa na composi√ß√£o de esp√©cies e
precipita√ß√£o nas comunidades.

```{r}
# Avaliar a rela√ß√£o entre os valores de diversidade beta total (Sorensen) e precipita√ß√£o
anova(lm(dados_dis$Sorensen ~ dados_dis$dados_prec))

# Avaliar a rela√ß√£o entre os valores do componente substitui√ß√£o (Simpson) e precipita√ß√£o
anova(lm(dados_dis$Simpson ~ dados_dis$dados_prec))

# Avaliar a rela√ß√£o entre os valores do componente aninhamento e precipita√ß√£o
anova(lm(dados_dis$Aninhamento ~ dados_dis$dados_prec))
```

**Interpreta√ß√£o dos resultados**

H√° uma rela√ß√£o positiva entre o componente aninhado da diversidade beta
e a diferen√ßa na precipita√ß√£o entre as comunidades (F~1,43~ = 6,4, P =
0,01). Contudo, n√£o h√° rela√ß√£o entre a diversidade beta total (Sorensen)
e o componente substitui√ß√£o de esp√©cies (Simpson) com a precipita√ß√£o (P
\> 0,05).

Agora vamos fazer um gr√°fico com o componente aninhamento da diversidade
beta.

```{r}
ggplot(data = dados_dis, aes(x= dados_prec, y= Aninhamento)) + 
  labs(x = "Diferen√ßa precipita√ß√£o (mm)", 
       y = "Componente aninhamento da\n diversidade beta") +
  geom_point(size = 4, shape = 21, fill = "darkorange") +
  tema_livro() +
  geom_smooth(method = lm, se = FALSE, color = "black") 
```

**Interpreta√ß√£o dos resultados**

As comunidades com baixa precipita√ß√£o anual apresentam esp√©cies que s√£o
um subgrupo das esp√©cies presentes nas comunidades com alta precipita√ß√£o
anual.

Agora vamos fazer um exemplo considerando os dados de abund√¢ncia das
esp√©cies.

::: {.alert .alert-info}
A fun√ß√£o `beta.pair.abund`gera tr√™s listas com matrizes triangulares:

-   **Diversidade beta total** = √≠ndice de Bray-Curtis (beta.bray);

-   **Componente varia√ß√£o balanceada (beta.bray.bal)**;

-   **Componente gradiente de abund√¢ncia (beta.bray.gra)**.
:::

An√°lise.

```{r}
resultado_AB <- beta.pair.abund(composicao_especies, index.family = "bray")
```

Cria um data.frame com os resultados.

```{r}
# Vamos montar um data.frame com os resultados
data.frame_AB <- data.frame(round(as.numeric(resultado_AB$beta.bray), 2),
                            round(as.numeric(resultado_AB$beta.bray.bal), 2),
                            round(as.numeric(resultado_AB$beta.bray.gra), 2))
colnames(data.frame_AB) <- c("Bray", "Balanceada", "Gradiente")
head(data.frame_AB)

## Agora vamos juntar os resultados com a precipita√ß√£o
dados_dis_AB <- data.frame(dados_prec, data.frame_AB)
```

Testar a rela√ß√£o da dissimilaridade considerando a abund√¢ncia com a
diferen√ßa na precipita√ß√£o entre as comunidades.

```{r}
## Avaliar a rela√ß√£o entre os valores de diversidade beta total e precipita√ß√£o
anova(lm(dados_dis_AB$Bray ~ dados_dis$dados_prec))

## Avaliar a rela√ß√£o entre os valores do componente balanceada e precipita√ß√£o
anova(lm(dados_dis_AB$Balanceada ~ dados_dis$dados_prec))

## Avaliar a rela√ß√£o entre os valores do componente gradiente e precipita√ß√£o
anova(lm(dados_dis_AB$Gradiente ~ dados_dis$dados_prec))
```

**Interpreta√ß√£o dos resultados**

H√° uma rela√ß√£o positiva entre os componentes varia√ß√£o balanceada
(F~1,43~ = 7,07, P = 0,01) e gradiente (F~1,43~ = 18,7, P \< 0,001) de
abund√¢ncia da diversidade beta com a diferen√ßa na precipita√ß√£o entre as
comunidades. Contudo, n√£o h√° rela√ß√£o entre a diversidade beta total
(Bray) com a precipita√ß√£o (F~1,43~ = 0,84, P = 0,36).

Vamos fazer um gr√°fico para cada um dos componentes da diversidade beta.

```{r}
ggplot(data = dados_dis_AB, aes(x= dados_prec, y= Balanceada)) + 
  labs(x = "Diferen√ßa precipita√ß√£o (mm)",
       y = "Componente varia√ß√£o balanceada\n da diversidade beta") +
  geom_point(size = 4, shape = 21, fill = "darkorange") +
  tema_livro() +
  geom_smooth(method = lm, se = FALSE, color = "black") 
```

**Interpreta√ß√£o dos resultados**

Olhando o √≠nicio do eixo X onde as comunidades apresentam precipita√ß√£o
anual similares (i.e. baixa diferen√ßa na precipita√ß√£o), o componente
varia√ß√£o balanceada indica que h√° uma tend√™ncia das esp√©cies com maiores
abund√¢ncias n√£o serem as mesmas quando comparamos duas comunidades (i.e.
maiores valores de dissimilaridade). Por outro lado, quando a diferen√ßa
na precipita√ß√£o entre duas comunidades √© alta, o componente varia√ß√£o
balanceada √© baixo, indicando que as mesmas esp√©cies est√£o dominando a
abund√¢ncia nas comunidades comparadas.

```{r}
ggplot(data = dados_dis_AB, aes(x= dados_prec, y= Gradiente)) + 
  labs(x = "Diferen√ßa precipita√ß√£o anual (mm)", 
       y = "Componente gradiente de abund√¢ncia\n da diversidade beta") +
  geom_point(size = 4, shape = 21, fill = "darkorange") +
  tema_livro() +
  geom_smooth(method = lm, se = FALSE, color = "black") 
```

**Interpreta√ß√£o dos resultados**

Olhando o √≠nicio do eixo X onde as comunidades apresentam precipita√ß√£o
anual similares (i.e. baixa diferen√ßa na precipita√ß√£o), o componente
gradiente indica que h√° uma tend√™ncia das esp√©cies apresentarem
abund√¢ncias parecidas (i.e. menor valor de dissimilaridade). Por outro
lado, quando a diferen√ßa na precipita√ß√£o entre duas comunidades √© alta,
o componente gradiente √© alto, indicando que as mesmas esp√©cies tem
valores discrepantes de abund√¢ncias entre as comunidades.

### Para se aprofundar

-   Recomendamos aos interessados a leitura dos artigos citados no
    cap√≠tulo e os livros Magurran & McGill [-@magurran_biological_2011] - Biological
    Diversity Frontiers in Measurement and Assessment and Legendre &
    Legendre [-@legendre_numerical_2012] - Numerical Ecology.
