#  Diversidade Filogen√©tica {#cap13}

### Pr√©-requisitos do cap√≠tulo {.unnumbered}

```{r}
## Pacotes
library(devtools)
# install_github("paternogbc/ecodados") 
library(ecodados)
# install_github("jinyizju/V.PhyloMaker")
library(V.PhyloMaker)
library(vegan)
library(ggplot2)
library(GGally)
library(ggpubr)
library(picante)
library(phytools)
library(ape)
library(geiger)
library(phyloregion)
library(pez)
library(reshape2)
library(betapart)

## Dados necess√°rios
minha_arvore <- ecodados::filogenia_aves
especies_plantas <- ecodados::sp_list
comunidade <- ecodados::comm
composicao_especies <- ecodados::composicao_aves_filogenetica
filogenia_aves <- ecodados::filogenia_aves
precipitacao <- precipitacao_filogenetica

```

## Aspectos te√≥ricos

A diversidade filogen√©tica captura a ancestralidade compartilhada entre as esp√©cies em termos de quantidade da hist√≥ria evolutiva e o grau de parentesco entre as esp√©cies. Pesquisadores t√™m utilizado diferentes m√©tricas de diversidade filogen√©tica em duas linhas de investiga√ß√µes principais: i) incorporar a hist√≥ria evolutiva das esp√©cies na sele√ß√£o das √°reas priorit√°rias para conserva√ß√£o visando minimizar a perda da diversidade evolutiva [@vane-wright1991; @faith1992; @v√©ron2019], e ii) produzir explica√ß√µes sobre os processos atuando na montagem das comunidades [@webb2002; @helmus2007]. A quantidade de artigos abordando ecologia, macroecologia e conserva√ß√£o com diversidade filogen√©tica cresceram exponencialmente nas √∫ltimas d√©cadas [@v√©ron2019]. Seguindo esta tend√™ncia, o n√∫mero de m√©tricas de diversidade filogen√©tica propostas n√£o param de aumentar. Tucker et al. [-@tucker2016] revisaram 70 m√©tricas de diversidade filogen√©tica e classificaram estas m√©tricas em tr√™s dimens√µes: i) **riqueza** - representa a soma da diferen√ßa filogen√©tica acumulada entre t√°xons; ii) **diverg√™ncia** - representa o padr√£o de diferen√ßa filogen√©tica entre t√°xons de uma assembleia; e iii) **regularidade** - representa o grau de varia√ß√£o das diferen√ßas filogen√©ticas entre t√°xons em uma assembleia. Outros autores utilizaram diferentes classifica√ß√µes [@pavoine2010; @vellend2011; @garamszegi2014]. Neste cap√≠tulo, iremos seguir a classifica√ß√£o de Tucker et al. [-@tucker2016] e mostrar algumas das principais m√©tricas dentro de cada uma dessas dimens√µes. Alguns autores recomendam que os pesquisadores n√£o foquem em apenas uma dimens√£o, mas comparem m√©tricas de diferentes dimens√µes [@tucker2016].

## Manipula√ß√£o de filogenias

Nesta se√ß√£o, iremos descrever os c√≥digos no R para carregar uma filogenia, plotar a filogenia, acessar os dados da filogenia e excluir e adicionar esp√©cies na filogenia. Estes s√£o c√≥digos introdut√≥rios e necess√°rios para realizarmos as an√°lises de diversidade filogen√©tica. N√£o iremos descrever os comandos necess√°rios para construir uma filogenia. Estamos assumindo que j√° existe uma filogenia dispon√≠vel para os organismos de interesse.

Mas antes vamos entender as terminologias de uma filogenia (Figura 1).

::: {.alert .alert-info}
 -   **√Årvore filogen√©tica:** s√£o hip√≥teses que representam o rela√ß√£o de parentesco entre as esp√©cies (pode ser tamb√©m individ√≠duos, genes, etc.) com informa√ß√µes sobre quais esp√©cies compartilham um ancestral comum e a dist√¢ncia (tempo, gen√©tica, ou diferen√ßas nos caracteres) que as separam;

 -   **N√≥:** o ponto onde uma linhagem da origem a duas ou mais linhagens descendentes;

 -   **Politomia:** Tr√™s ou mais linhagens descendendo de um √∫nico n√≥;

 -   **Ramo:** uma linha orientada ao longo de um eixo terminais-raiz que conecta os n√≥s na filogenia;

 -   **Terminal (do ingl√™s *tip*):** o final do ramo representando uma esp√©cie atual ou extinta (pode tamb√©m reprentar g√™neros, indiv√≠duos, genes, etc.);

 -   **Raiz:** representa o ancestral comum de todas as esp√©cies na filogenia;

 -   **Clado:** um grupo de esp√©cies aparentadas descendendo de um √∫nico n√≥ na filogenia;

 -   **Ultram√©trica:** a dist√¢ncia de todos os terminais at√© a raiz s√£o identicas. Caracter√≠stica requerida pela maioria dos √≠ndices de diversidade filogen√©tica.
:::


![Ilustra√ß√µes de diferentes √°rvores filogen√©ticas. A) √Årvore enraizada e ultram√©trica indicando a raiz da √°rvore, n√≥s, ramos, comprimento do ramo, politomias e terminais. B) √Årvore n√£o enraizada que mostra as rela√ß√µes entre as esp√©cies, mas n√£o define a hist√≥ria evolutiva. C) √Årvore n√£o ultram√©trica onde as esp√©cies apresentam diferentes dist√¢ncias at√© a raiz.](Figura%20-%20terminologias.jpg)

<p>

¬†

</p>

Agora vamos plotar a filogenia para visualizar as rela√ß√µes entre as 37 esp√©cies de aves end√™micas da Mata Atl√¢ntica. filogenia foi extra√≠da de Jetz et al. [-@jetz2012]. Os dados est√£o dispon√≠veis no pacote *ecodados*.

```{r}
plot.phylo (minha_arvore, type = "phylogram", show.tip.label = TRUE, 
            show.node.label = TRUE, edge.color = "black", edge.width = 1.5, 
            tip.color = "black", cex = 0.45, label.offset = 2) 

```

Podemos alterar o formato de apresenta√ß√£o da filogenia usando o argumento `type` e a cor dos ramos usando o argumento `edge.color`.

```{r}
plot.phylo (minha_arvore, type = "fan", show.tip.label = TRUE, 
            show.node.label = TRUE, edge.color = "blue", edge.width = 1.5, 
            tip.color = "black", cex = 0.45, label.offset = 2) 
```

Percebam que existem v√°rios argumentos para modificar a largura e cor dos ramos, tamanho da fonte, dist√¢ncia entre a filogenia e o nomes da esp√©cies e muito mais. Uma sugest√£o √© visitar o blog do professor Liam Revell (<http://blog.phytools.org/>) que √© o criador e mantenedor do pacote *phytools* no R.

Um das caracter√≠sticas mais interessantes do R √© que podemos acessar as informa√ß√µes do objeto. Neste caso, o nosso objeto √© a filogenia e, muitas vezes, temos interesse nas informa√ß√µes que est√£o inseridas dentro da filogenia. Para sabermos quais s√£o as informa√ß√µes que podemos acessar na filogenia, vamos usar a fun√ß√£o `names()`.

```{r}
names(minha_arvore)
```

Temos acesso a quatro componentes da filogenia: i) ramo (`edge`), ii) comprimento do ramo (`edge.length`), iii) n√∫mero de n√≥s (`Nnode`), e iv) nome das esp√©cies (`tip.label`). Podemos usar o operador `$` para acessar estes componentes. Veja abaixo como acessar o nome das 37 esp√©cies de aves na filogenia.

```{r}
minha_arvore$tip.label
```

ou o comprimento de cada um dos ramos da filogenia.

```{r}
minha_arvore$edge.length
```

Nas an√°lises de diversidade filogen√©tica, as esp√©cies que estar√£o presentes na filogenia normalmente s√£o aquelas que foram amostradas no seu estudo. Contudo, muitas vezes utilizamos filogenias contendo esp√©cies que n√£o est√£o presentes no nosso estudo. Neste caso, precisamos excluir essas esp√©cies da filogenia. A fun√ß√£o `drop.tip()` faz essa tarefa.

```{r}
# Vamos criar um novo nome para o objeto e excluir as esp√©cies Leucopternis polionotus 
# e Aramides saracura da filogenia
filogenia_cortada <- drop.tip(minha_arvore, c("Leucopternis_polionotus", 
                                              "Aramides_saracura")) 

filogenia_cortada
```

Vejam que agora a filogenia tem 35 esp√©cies de aves. As duas esp√©cies que selecionamos foram exclu√≠das da filogenia.

Outra situa√ß√£o bem comum √© quando precisamos inserir esp√©cies que foram amostradas no nosso estudo, mas n√£o est√£o presente na filogenia. Para isso, vamos usar a fun√ß√£o `add.species.to.genus`. A fun√ß√£o `force.ultrametric` √© usada para que a filogenia continue sendo ultram√©trica (sem essa fun√ß√£o a √°rvore perde os comprimentos dos ramos)

::: {.alert .alert-info}
<strong> üìù Importante: </strong> O comprimento do ramo que a esp√©cie ir√° receber depender√° de onde voc√™ indicar a inser√ß√£o da esp√©cie.

As op√ß√µes s√£o:

-   **root** que insere a esp√©cie no ancestral comum mais recente (MRCA) de todas as esp√©cies do g√™nero (*default*);

-  **random** que insere a esp√©cie aleatoriamente dentro do clado do MRCA contendo todos as esp√©cies do g√™nero.
:::

```{r}
# Vamos inserir as esp√©cies Megascops_sp1, Carponis_sp, Strix_sp1, Strix_sp2 e
# Strix_sp3 na filogenia
Megascops <- c("Megascops_sp1")
Carpornis <- c("Carpornis_sp1")
Strix <- c("Strix_sp1", "Strix_sp2", "Strix_sp3")

# Inserindo esp√©cies como politomias
filogenia_nova <- add.species.to.genus(force.ultrametric(minha_arvore), Megascops)
filogenia_nova <- add.species.to.genus(force.ultrametric(filogenia_nova), 
                                       Carpornis)

```

Agora vamos inserir v√°rias esp√©cies dentro do mesmo g√™nero.

```{r}
# Para inserir mais de uma esp√©cie dentro do g√™nero, vamos utilizar um loop.  
for(i in 1:length(Strix)) 
filogenia_nova <- add.species.to.genus(force.ultrametric(filogenia_nova),
                                       Strix[i], where="root")

plot(filogenia_nova, cex = 0.5, no.margin = TRUE)
```

Vamos fazer outro exemplo usando a fun√ß√£o `phylo.maker()` do pacote `V.PhyloMaker` que adiciona as esp√©cies nos g√™neros ou os g√™neros nas fam√≠lias usando uma filog√™nia *backbone*. 

Essa fun√ß√£o permite a adi√ß√£o dos g√™neros ou esp√©cies considerando tr√™s cen√°rios diferentes:

Cen√°rio 1 - adiciona g√™neros ou esp√©cies como politomias basais dentro das fam√≠lias ou g√™neros da filogenia respectivamente.

Cen√°rio 2 - adiciona g√™neros e esp√©cies aleatoriamente nas fam√≠lias ou g√™neros da filogenia respectivamente.

Cen√°rio 3 - adiciona g√™neros e esp√©cies nas fam√≠lias ou g√™neros da filogenia respectivamente usando as abordagens implementadas no *Phylomatic* e *BLADJ*.

```{r}
# A fun√ß√£o phylo.maker usa uma filogenia default de plantas (i.e. GBOTB.extended).
# Caso voc√™ queira utilizar outra filogenia, √© s√≥ alterar o argumento tree
novas_filogenias <- phylo.maker(especies_plantas,
                                tree = GBOTB.extended,
                                scenarios=c("S1","S2","S3"))

# Gr√°fico mostrando o resultado para os cen√°rios 1 e 3
par(mfrow = c(1, 2))
plot.phylo(novas_filogenias$scenario.1, cex = 0.5, main = "Cen√°rio 1")
plot.phylo(novas_filogenias$scenario.3, cex = 0.5, main = "Cen√°rio 3")
dev.off()
```

## M√©tricas de diversidade alfa filogen√©tica

M√©tricas de diversidade alfa utilizam os dados de incid√™ncia (presen√ßa e aus√™ncia) ou abund√¢ncia das esp√©cies para determinar um valor de diversidade para cada comunidade ou s√≠tio de interesse.

#### Exemplo pr√°tico 1 - Medidas de diversidade filogen√©tica

**Explica√ß√£o dos dados**

Avaliaremos a diversidade filogen√©tica de 10 comunidades de aves amostradas ao longo de um gradiente de precipita√ß√£o. Utilizaremos este conjunto de dados para todos os exemplos deste cap√≠tulo.

**Pergunta:**

> A varia√ß√£o na distribui√ß√£o espacial dos valores de diversidade filogen√©tica das comunidades est√° associada com o gradiente de precipita√ß√£o?

**Predi√ß√µes**

> Os valores de diversidade filogen√©tica ser√£o maiores nas comunidades localizadas em regi√µes com altas precipita√ß√µes do que em regi√µes mais secas.

**Vari√°veis**

-   Vari√°veis resposta e preditoras

    -   Dataframe com as comunidades (unidade amostral) nas linhas e as esp√©cies de aves nas colunas (vari√°vel resposta).
    -   Dataframe com as comunidades (unidade amostral) nas linhas e a vari√°vel precipita√ß√£o anual na coluna (vari√°vel preditora).
    -   Arquivo com a filogenia das 37 esp√©cies de aves (vari√°vel resposta).

**Checklist**

-   Verificar se os dataframes de composi√ß√£o de esp√©cies e vari√°veis ambientais est√£o com as unidades amostrais nas linhas e vari√°veis preditoras nas colunas

-   Verificar se as comunidades nos dataframes de composi√ß√£o de esp√©cies e vari√°veis ambientais est√£o distribu√≠dos na mesma sequ√™ncia/ordem nos dois arquivos.

-   Verificar se o nome das esp√©cies de aves no dataframe de composi√ß√£o de esp√©cies √© id√™ntico ao nome das esp√©cies na filogenia.

## An√°lise da dimens√£o riqueza da diversidade alfa filogen√©tica

As m√©tricas de riqueza somam a quantidade da diferen√ßa filogen√©tica presente em uma comunidade (Tucker et al. 2016).

### Phylogenetic diversity (PD, Faith 1992)

Esta m√©trica √© definida pela soma do comprimento dos ramos conectando todas as esp√©cies na comunidade. √â a m√©trica mais conhecida e usada nos estudos de conserva√ß√£o e comunidade.

Vamos conferir se os nomes das esp√©cies de aves no dataframe de composi√ß√£o s√£o os mesmos da filogenia - *OK* indica que os nomes est√£o corretos. Caso contr√°rio, verificar e arrumar.

```{r}
name.check(filogenia_aves, t(composicao_especies))
```

Os nomes das esp√©cies que est√£o na planilha s√£o iguais aos nomes das esp√©cies que est√£o na filogenia. Podemos continuar as an√°lises.

Abaixo, demonstramos os c√≥digos no R para o c√°lculo de PD para as comunidades de aves.

```{r}
# Calculando a m√©trica de diversidade filogen√©tica proposta por Faith (1992).
resultados_PD <- pd(composicao_especies, filogenia_aves)

# Mostra o valor de PD e riqueza de esp√©cies para cada comunidade.
resultados_PD
```

A comunidade 2 abriga a maior diversidade filogen√©tica com a composica√ß√£o de esp√©cies contemplando 1293,15 milh√µes de anos (i.e. soma do comprimento dos ramos ligando todas as esp√©cies da comunidade). Por outro lado, a comunidade 10 abriga a menor diversidade filogen√©tica contemplando 599,69 milh√µes de anos. Importante, este √≠ndice √© correlacionado com a riqueza de esp√©cies. Discutiremos essa quest√£o na se√ß√£o de modelos nulos.

## Phylogenetic Species Richness (PSR, Helmus et al. 2007)

Esta m√©trica √© calculada multiplicando a riqueza de esp√©cies registrada na comunidade pela *Phylogenetic Species Variability* (PSV) da comunidade. PSR √© diretamente compar√°vel ao n√∫mero de esp√©cies na comunidade, mas inclui o parentesco filogen√©tico entre as esp√©cies.

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do PSR utilizando os dados das comunidades de aves.

```{r}
# An√°lise com dados de composi√ß√£o das esp√©cies nas comunidades.
resultados_PSR <- psr(composicao_especies,filogenia_aves)

# Mostra os valores de PSR para cada comunidade.
resultados_PSR 
```

## Phylogenetic Endemism (PE, Rosauer et al. 2009)

Esta m√©trica calcula a fra√ß√£o dos ramos restritas a regi√µes espec√≠ficas. PE identifica √°reas ou comunidades que abrigam componentes restritos da diversidade filogen√©tica. PE √© uma m√©trica proposta para auxiliar estudos de conserva√ß√£o estabelecendo crit√©rios para priorizar regi√µes a serem conservadas com base na import√¢ncia evolutiva (i.e. partes da filog√™nia com distribui√ß√£o espacial limitada) das esp√©cies que ocorrem nestes locais [@rosauer2009].

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do PE utilizando os dados das comunidades de aves.

```{r}
# Transformando data.frame em matriz.
dados_matriz <- as.matrix(composicao_especies)

# An√°lise.
resultados_PE <- phylo_endemism(dados_matriz, filogenia_aves, 
                               weighted = TRUE)

# Mostra os valores de PE para cada comunidade.
resultados_PE 
```

O √≠ndice PE considera as 10 comunidades como o range espacial m√°ximo. Se todas as esp√©cies ocorressem nas 10 comunidades, o valor de PE seria 1 indicando baixo endemismo filogen√©tico. A comunidade 2 abriga um conjunto de esp√©cies cujo os ramos com distribui√ß√£o espacial restrita contemplam 272,6 milh√µes de anos. Por outro lado, a comunidade 10 abriga um conjunto de esp√©cies cujo os ramos com distribui√ß√£o espacial restrita contemplam 68,5 milh√µes de anos . Assim, as comunidades 2, 1 e 4 s√£o as √°reas que abrigam os maiores endemismo filogen√©ticos.

## Species Evolutionary Distinctiveness (ED, Redding & Mooers 2006)

Esta m√©trica calcula qual √© a fra√ß√£o da √°rvore filogen√©tica que √© atribu√≠da para uma esp√©cie. ED reflete qu√£o evolutivamente isolada uma esp√©cie √© comparada com as outras esp√©cies na filogenia [@redding2006]. ED √© uma m√©trica proposta para auxiliar estudos de conserva√ß√£o estabelecendo crit√©rios para priorizar as esp√©cies a serem conservadas com base na sua import√¢ncia evolutiva (exclusividade do comprimento do ramo) que n√£o √© comportilhada com outras esp√©cies. Portanto, apenas as informa√ß√µes da filogenia s√£o utilizadas para o c√°lculo de ED.

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do ED utilizando os dados das comunidades de aves.

```{r}
# An√°lise.
resultados_ED <- evol.distinct(filogenia_aves)

# Mostra os valores de ED para cada esp√©cie.
head(resultados_ED)
```

## An√°lise da dimens√£o diverg√™ncia da diversidade alfa filogen√©tica

As m√©tricas de diverg√™ncia utilizam a m√©dia da distribui√ß√£o das unidades extra√≠das da √°rvore filogen√©tica [@tucker2016].

## Mean Pairwise Distance (MPD, Webb et al. 2002)

Esta m√©trica utiliza a matriz de dist√¢ncia filogen√©tica para quantificar a dist√¢ncia m√©dia do parentesco entre pares de esp√©cies em uma comunidade. Este √≠ndice pode ser calculado considerando dados de incid√™ncia ou considerando dados de abund√¢ncia das esp√©cies. Importante, o MPD √© uma m√©trica que pesa a estrutura interna da filogenia (e.g. rela√ß√µes entre esp√©cies de fam√≠lias diferentes).

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do MPD utilizando os dados das comunidades de aves. 

Vamos iniciar com dados de incid√™ncia (presen√ßa e aus√™ncia) das esp√©cies nas comunidades. A fun√ß√£o  `cophenetic` gera uma matriz com as dist√¢ncias par a par entre as esp√©cies. Essas dist√¢ncias s√£o utilizadas para computar a dist√¢ncia m√©dia do parentesco das esp√©cies dentro das comunidades. 

```{r}
resultados_MPD_PA <- mpd(composicao_especies, cophenetic(filogenia_aves), 
                         abundance.weighted = FALSE)

# Mostra os valores de MPD para cada comunidade.
resultados_MPD_PA 
```

A comunidade 9 abriga a composi√ß√£o de esp√©cies mais aparentada (i.e. menor diversidade filogen√©tica) com dist√¢ncia m√©dia entre as esp√©cies de 139,62 milh√µes de anos. Por outro lado, a comunidade 2 abriga a composi√ß√£o de esp√©cies menos aparentada (i.e. maior diversidade filogen√©tica) com dist√¢ncia m√©dia de 157,31 milh√µes anos.

Vamos refazer a an√°lise do MPD, mas desta vez, considerando a abund√¢ncia das esp√©cies de aves nas comunidades. Para isso, alteramos o argumento `abundance.weighted = TRUE`.

```{r}
# An√°lise com dados de abund√¢ncia das esp√©cies nas comunidades.
resultados_MPD_AB <- mpd(composicao_especies, cophenetic(filogenia_aves), 
                         abundance.weighted = TRUE)

# Mostra os valores de MPD para cada comunidade.
resultados_MPD_AB 
```

Percebam que pesando o comprimento do ramo pela abund√¢ncia das esp√©cies altera-se os valores do √≠ndice de diversidade filogen√©tica. Neste caso, a comunidade 10 passa a ser a comunidade que abriga a composi√ß√£o de esp√©cies mais aparentada (i.e. menor diversidade filogen√©tica) com dist√¢ncia m√©dia entre as esp√©cies de 117,88 milh√µes de anos.

## Mean Nearest Taxon Distance (MNTD, Webb et al. 2002)

Esta m√©trica utiliza a matriz de dist√¢ncia filogen√©tica para quantificar a m√©dia dos valores m√≠nimos de parentesco entre pares de esp√©cies em uma comunidade. Ou seja, qual o valor m√©dio da dist√¢ncia para o vizinho mais pr√≥ximo. Este √≠ndice pode ser calculado considerando dados de incid√™ncia (presen√ßa e aus√™ncia) ou considerando dados de abund√¢ncia das esp√©cies. Diferente do MPD, o MNTD √© uma m√©trica terminal que pesa as rela√ß√µes nas pontas da filogenia (e.g. esp√©cies dentro do mesmo g√™nero).

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do MNTD utilizando os dados das comunidades de aves.

```{r}
# An√°lise com dados de presen√ßa e aus√™ncia das esp√©cies nas comunidades.
resultados_MNTD_PA <- mntd(composicao_especies, cophenetic(filogenia_aves), 
                         abundance.weighted = FALSE)

# Mostra os valores de MPD para cada comunidade.
resultados_MNTD_PA 
```

A comunidade 9 abriga a composi√ß√£o de esp√©cies com dist√¢ncia m√©dia do vizinho mais pr√≥ximo de 62,34 milh√µes de anos. Esse resultado indica que as esp√©cies terminais s√£o mais aparentada (e.g. esp√©cies do mesmo g√™nero) do que a composi√ß√£o de esp√©cies da comunidade 10 onde a dist√¢ncia m√©dia do vizinho mais pr√≥ximo √© 112,23 milh√µes de anos (e.g. esp√©cies de g√™neros diferentes).

Vamos refazer a an√°lise do MNTD, mas desta vez, considerando a abund√¢ncia das esp√©cies de aves nas comunidades.

```{r}
# An√°lise com dados de abund√¢ncia das esp√©cies nas comunidades.
resultados_MNTD_AB <- mntd(composicao_especies, cophenetic(filogenia_aves), 
                         abundance.weighted = TRUE)

# Mostra os valores de MPD para cada comunidade.
resultados_MNTD_AB 
```

## Phylogenetic Species Variability (PSV, Helmus et al. 2007)

Esta m√©trica estima a quantidade relativa dos comprimentos dos ramos n√£o compartilhados entre as comunidades. Quando todas as esp√©cies em uma amostra n√£o s√£o aparentadas (i.e. filogenia em estrela), o valor do PSV √© 1 (um), indicando m√°xima variabilidade. Quando as esp√©cies tornando-se mais aparentadas, o valor de PSV aproxima-se de 0 (zero), indicando reduzida variabilidade. Os valores esperados de PSV s√£o estatisticamente independentes da riqueza de esp√©cies. 

::: {.alert .alert-info}
<strong> üìù Importante: </strong> Os valores de PSV s√£o id√™nticos ao MPD quando a filogenia √© ultram√©trica.
:::

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do PSV utilizando os dados das comunidades de aves.

```{r}
# An√°lise com dados de presen√ßa e aus√™ncia das esp√©cies nas comunidades.
resultados_PSV <- psv(composicao_especies,filogenia_aves)

# Mostra os valores de PSV para cada comunidade.
resultados_PSV 
```

## An√°lise da dimens√£o regularidade da diversidade alfa filogen√©tica

As m√©tricas de regularidade caracterizam a varia√ß√£o das dist√¢ncias entre as esp√©cies em uma comunidade [@tucker2016].

## Variance of Pairwise Distance (VPD, Clarke & Warwick 2001)

Esta m√©trica utiliza a matriz de dist√¢ncia filogen√©tica para quantificar a vari√¢ncia do parentesco entre pares de esp√©cies em uma comunidade [@clarke2001].

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do VPD utilizando os dados das comunidades de aves.

```{r}
# Transformando data.frame em matriz.
dados_matriz <- as.matrix(composicao_especies)

# Transformar os dados para o formato requerido pelo pacote pez.
dados <- comparative.comm (filogenia_aves, dados_matriz)

# An√°lise.
resultados_VPD <- .vpd(dados, cophenetic(filogenia_aves))

# Mostra os valores de VPD para cada comunidade.
resultados_VPD 
```

## Correla√ß√£o entre as m√©tricas de diversidade alfa filogen√©tica

Vamos avaliar a correla√ß√£o entre os valores das m√©tricas de diversidade alfa filogen√©tica. Vamos criar um data.frame com os resultados das m√©tricas separados para as dimens√µes de riqueza e diverg√™ncia. N√£o iremos fazer para regularidade pois s√≥ apresentamos uma m√©trica de diversidade filogen√©tica nesta dimens√£o.

```{r}
# Vamos criar um data.frame com os resultados das m√©tricas da dimens√£o riqueza.
metricas_riqueza <- data.frame(riqueza = resultados_PD$SR,
                       PD = resultados_PD$PD,
                       PSR = resultados_PSR$PSR,
                       PE = resultados_PE)

# Gr√°fico mostrando na parte:
# i) inferior a distribui√ß√£o dos pontos considerando as m√©tricas pareadas;
# ii) superior o valor da correla√ß√£o de pearson; e 
# iii) diagonal a curva de densidade. 
ggpairs(metricas_riqueza, upper = list(continuous = wrap("cor", size = 4)))
```

Percebam que as tr√™s m√©tricas apresentam correla√ß√µes pareadas acima de 96%. Isso indica que as m√©tricas s√£o redundantes. Portanto, n√£o h√° necessidade de calcular mais de uma m√©trica dentro da dimens√£o da riqueza filogen√©tica. Al√©m disso, as tr√™s m√©tricas de diversidade alfa filogen√©tica tamb√©m apresentam alta correla√ß√£o com a riqueza de esp√©cies. Veja abaixo na se√ß√£o de modelos nulos como controlar o efeito da riqueza de esp√©cies nas m√©tricas de diversidade filogen√©tica.

Vamos avaliar a correla√ß√£o entre os valores das m√©tricas de diversidade alfa filog√©netica para a dimens√£o diverg√™ncia.

```{r}
# Vamos criar um data.frame com os resultados das m√©tricas da dimens√£o diverg√™ncia.
metricas_divergencia <- data.frame(riqueza = resultados_PD$SR,
                       MPD = resultados_MPD_PA,
                       MPD_AB = resultados_MPD_AB,
                       MNTD = resultados_MNTD_PA,
                       MNTD_AB = resultados_MNTD_AB,
                       PSV = resultados_PSV$PSVs)

# Gr√°fico.
ggpairs(metricas_divergencia, upper = list(continuous = wrap("cor", size = 4)))
```

Como mencionado, as m√©tricas MPD e PSV s√£o id√™nticas quando usamos uma filogenia ultram√©trica. Contudo, as m√©tricas de diverg√™ncia n√£o apresentam correla√ß√µes t√£o altas como as m√©tricas da dimens√£o riqueza, com exce√ß√£o do MNTD usando dados de incid√™ncia e abund√¢ncia que foram fortemente correlacionados (r = 0,9). Al√©m disso, estas m√©tricas n√£o s√£o t√£o afetadas pela riqueza de esp√©cies das comunidades como as m√©tricas da dimens√£o riqueza.

## Associa√ß√£o entre as m√©tricas de diversidade alfa filogen√©tica e o gradiente de precipita√ß√£o

Vamos avaliar e plotar a rela√ß√£o entre os valores de algumas m√©trica de diversidade alfa filogen√©tica (vari√°vel resposta) e os valores de precipita√ß√£o (vari√°vel preditora).

```{r}
# Vamos inserir os dados de precipita√ß√£o na planilha metrica_divergencia.
metricas_divergencia$precipitacao <- precipitacao_filogenetica$prec

# Gr√°ficos.
MPD_PA_plot <- ggplot(metricas_divergencia, aes(precipitacao, MPD)) +
        labs(x = "Precipita√ß√£o (mm)", 
             y = "Mean Pairwise Distance\n (MPD - Aus√™ncia e Presen√ßa)") +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
       tema_livro()
MPD_AB_plot <- ggplot(metricas_divergencia, aes(precipitacao, MPD_AB)) +
        labs(x = "Precipita√ß√£o (mm)", 
             y = "Mean Pairwise Distance\n (MPD - Abund√¢ncia)", size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() 
MNTD_AP_plot <- ggplot(metricas_divergencia, aes(precipitacao, MNTD)) +
        labs(x = "Precipita√ß√£o (mm)", 
             y = "Mean Nearest Taxon Distance\n (MNTD - Aus√™ncia e Presen√ßa)", 
             size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() 
MNTD_AB_plot <- ggplot(metricas_divergencia, aes(precipitacao, MNTD_AB)) +
        labs(x = "Precipita√ß√£o (mm)", 
             y = "Mean Nearest Taxon Distance\n (MNTD - Abund√¢ncia)", 
             size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
ggarrange(MPD_PA_plot, MPD_AB_plot, MNTD_AP_plot, MNTD_AB_plot,
          ncol = 2, nrow = 2)
```

O MPD, que avalia as rela√ß√µes de parentesco mais internas da filogenia (i.e. rela√ß√µes entre esp√©cies de fam√≠lias diferentes) n√£o apresentou associa√ß√£o com o gradiente de precipita√ß√£o. Por outro lado, o MNTD que avalia as rela√ß√µes mais terminais da filogenia (i.e. esp√©cies dentro do mesmo g√™nero) apresentou uma rela√ß√£o negativa com o gradiente de precipita√ß√£o. Interessante que a associa√ß√£o s√≥ foi significativa quando pesamos a an√°lise pela abund√¢ncia das esp√©cies nas comunidades. Esses resultados demonstram a import√¢ncia da sele√ß√£o das m√©tricas de diversidade filogen√©tica e tipos de dados (e.g. incid√™ncia ou abund√¢ncia) utilizados na interpreta√ß√£o dos padr√µes observados na natureza.

Vamos ver os gr√°ficos das m√©tricas da dimens√£o riqueza da diversidade alfa filogen√©tica

```{r}
# Vamos inserir os dados de precipita√ß√£o na planilha metrica_riqueza.
metricas_riqueza$precipitacao <- precipitacao$prec

# Gr√°ficos.
Riqueza_plot <- ggplot(metricas_riqueza, aes(precipitacao, riqueza)) +
        labs(x = "Precipita√ß√£o (mm)", 
             y = "Riqueza de esp√©cies") +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
         
PD_plot <- ggplot(metricas_riqueza, aes(precipitacao, PD)) +
        labs(x = "Precipita√ß√£o (mm)", 
             y = "Diversidade Filogen√©tica\n (Faith)", size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        
PSR_plot <- ggplot(metricas_riqueza, aes(precipitacao, PSR)) +
        labs(x = "Precipita√ß√£o (mm)", 
             y = "Phylogenetic Species Richness\n (PSR)", 
             size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        
PE_plot <- ggplot(metricas_riqueza, aes(precipitacao, PE)) +
        labs(x = "Precipita√ß√£o (mm)", 
             y = "Phylogenetic Endemism\n (PE)", 
             size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        
ggarrange(Riqueza_plot, PD_plot, PSR_plot, PE_plot, ncol = 2, nrow = 2)
```

As tr√™s m√©tricas de diversidade filogen√©tica foram relacionadas com o gradiente de precipita√ß√£o. Esse resultado indica que comunidades localizadas em √°reas com maior precipita√ß√£o anual abrigaram maior diversidade filogen√©tica do que comunidades localizadas em √°reas mais secas. Contudo, estas m√©tricas s√£o dependentes da riqueza de esp√©cies nas comunidades. Veja abaixo a se√ß√£o de modelos nulos para entender como lidar com essa depend√™ncia.

## M√©tricas de diversidade beta filogen√©tica

M√©tricas de diversidade beta filogen√©tica utilizam dados de presen√ßa e aus√™ncia ou abund√¢ncia das esp√©cies para determinar um valor que representa a diferen√ßa entre comunidades em rela√ß√£o a hist√≥ria evolutiva das linhagens.

## An√°lise da dimens√£o diverg√™ncia da diversidade beta filogen√©tica

## Community Mean Pairwise Distance (COMDIST, Webb et al. 2008)

Esta m√©trica √© uma extens√£o do MPD. COMDIST calcula a m√©dia da dist√¢ncia filogen√©tica entre as esp√©cies de duas comunidades [@webb2008]. COMDIST pode ser calculada usando dados de incid√™ncia (presen√ßa e aus√™ncia) ou abund√¢ncia das esp√©cies. Esta extens√£o do MPD tamb√©m √© conhecida na literatura como Dpw [@swenson2011; @swenson2014].

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do COMDIST utilizando os dados das comunidades de aves.

```{r}
# An√°lise com dados de presen√ßa e aus√™ncia das esp√©cies nas comunidades.
resultados_Comdist_PA <- comdist(composicao_especies, 
                                 cophenetic(filogenia_aves), 
                                 abundance.weighted = FALSE)
```

Vamos refazer a an√°lise do COMDIST, mas desta vez, considerando a abund√¢ncia das esp√©cies de aves nas comunidades.

```{r}
# An√°lise com dados de abund√¢ncia das esp√©cies nas comunidades.
resultados_Comdist_AB <- comdist(composicao_especies, 
                                 cophenetic(filogenia_aves), 
                                 abundance.weighted = TRUE)
```

## Community Mean Nearest Taxon Distance (COMDISTNT, Webb et al. 2008)

Esta m√©trica √© uma extens√£o do MNTD. COMDISTNT calcula a m√©dia da dist√¢ncia filogen√©tica entre o t√°xon mais pr√≥ximo das esp√©cies de duas comunidades. COMDISTNT pode ser calculada usando dados de incid√™ncia ou abund√¢ncia das esp√©cies. Esta extens√£o do MNTD tamb√©m √© conhecida na literatura como Dnn [@swenson2011].

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do COMDISTNT utilizando os dados das comunidades de aves.

```{r}
# An√°lise com dados de presen√ßa e aus√™ncia das esp√©cies nas comunidades.
resultados_Comdistnt_PA <- comdistnt(composicao_especies, 
                                     cophenetic(filogenia_aves), 
                                     abundance.weighted = FALSE)
```

Vamos refazer a an√°lise do COMDISTNT, mas desta vez, considerando a abund√¢ncia das esp√©cies de aves nas comunidades.

```{r}
# An√°lise com dados de abund√¢ncia das esp√©cies nas comunidades.
resultados_Comdistnt_AB <- comdistnt(composicao_especies, 
                                     cophenetic(filogenia_aves), 
                                     abundance.weighted = TRUE)
```

## Correla√ß√£o entre as m√©tricas de diversidade beta filogen√©tica

Vamos avaliar a correla√ß√£o entre os valores das m√©tricas da diversidade beta filogen√©tica para a dimens√£o diverg√™ncia.

```{r}
# Vamos criar um data.frame com os resultados das m√©tricas da dimens√£o
# diverg√™ncia.
metricas_divergencia_beta <- data.frame(
                            COMDIST_PA = as.numeric(resultados_Comdist_PA),
                            COMDIST_AB = as.numeric(resultados_Comdist_AB),
                            COMDISTNT_PA = as.numeric(resultados_Comdistnt_PA),
                            COMDISTNT_AB = as.numeric(resultados_Comdistnt_AB))

# Gr√°fico.
ggpairs(metricas_divergencia_beta,
        upper=list(continuous = wrap("cor", size = 4)))
```

Os valores das m√©tricas de diverg√™ncia filogen√©tica beta apresentam correla√ß√µes mais baixas do que as m√©tricas da dimens√£o riqueza . Lembrem-se que COMDIST e COMDISTNT d√£o pesos diferentes para as rela√ß√µes de parentesco. COMDIST pesa as rela√ß√µes mais basais e internas da filogenia, enquanto COMDISTNT pesa as rela√ß√µes nas partes terminais da filogenia. Portanto, elas podem trazer informa√ß√µes complementares.

## Associa√ß√£o entre as m√©tricas de diversidade beta filogen√©tica e o gradiente de precipita√ß√£o

Vamos avaliar e plotar a rela√ß√£o entre os valores de algumas m√©trica de diversidade beta filogen√©tica (vari√°vel resposta) e os valores de precipita√ß√£o (vari√°vel preditora).

```{r}
# Precisamos calcular a dissimilaridade par a par da precipita√ß√£o entre 
# as comunidades.
dis_prec <- vegdist(precipitacao, "euclidian")

# Vamos inserir estes dados na planilha metrica_divergencia_beta.
metricas_divergencia_beta$dis_prec <- as.numeric(dis_prec)

# Gr√°ficos.
COMDIST_PA_plot <- ggplot(metricas_divergencia_beta, 
                          aes(dis_prec, COMDIST_PA)) +
        labs(x = "Diferen√ßa na precipita√ß√£o (mm)", 
             y = "COMDIST\n (Presen√ßa e Aus√™ncia)") +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() 
         
COMDIST_AB_plot <- ggplot(metricas_divergencia_beta, 
                          aes(dis_prec, COMDIST_AB)) +
        labs(x = "Diferen√ßa na precipita√ß√£o (mm)", 
             y = "COMDIST\n (Abund√¢ncia)", size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        
COMDISTNT_PA_plot <- ggplot(metricas_divergencia_beta, 
                            aes(dis_prec, COMDISTNT_PA)) +
        labs(x = "Diferen√ßa na precipita√ß√£o (mm)", 
             y = "COMDISTNT\n (Aus√™ncia e Presen√ßa)", 
             size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        
COMDISTNT_AB_plot <- ggplot(metricas_divergencia_beta, 
                            aes(dis_prec, COMDISTNT_AB)) +
        labs(x = "Diferen√ßa na precipita√ß√£o (mm)", 
             y = " COMDISTNT\n (Abund√¢ncia)", 
             size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() 
        
ggarrange(COMDIST_PA_plot, COMDIST_AB_plot, COMDISTNT_PA_plot, 
          COMDISTNT_AB_plot, ncol = 2, nrow = 2)
dev.off()
```

O COMDIST que avalia as rela√ß√µes de parentesco mais internas da filogenia (i.e. rela√ß√µes entre esp√©cies de fam√≠lias diferentes) apresentou associa√ß√£o com o gradiente de precipita√ß√£o quando avaliado pesado pela abund√¢ncia das esp√©cies. Por outro lado, o COMDISTNT que avalia as rela√ß√µes mais terminais da filogenia (i.e. esp√©cies dentro do mesmo g√™nero) apresentou uma rela√ß√£o negativa com o gradiente de precipita√ß√£o quando avaliado usando a incid√™ncia das esp√©cies.

## An√°lise da dimens√£o riqueza da diversidade beta filogen√©tica

## Phylogenetic index of beta diversity (Phylosor, Bryant et al. 2008)

Phylosor √© uma m√©trica de similaridade e determina o comprimento total dos ramos da filogenia que √© compartilhado entre pares de comunidades [@bryant2008].

Abaixo, demonstramos os c√≥digos no R para o c√°lculo do Phylosor utilizando os dados das comunidades de aves.

```{r}
# An√°lise com dados de presen√ßa e aus√™ncia das esp√©cies nas comunidades.
resultados_Phylosor <- phylosor(composicao_especies,filogenia_aves)

# Mostra uma matriz triangular com a similaridade entre a fra√ß√£o dos ramos 
# compartilahdos entre duas comunidades
resultados_Phylosor 
```

## Unique Fraction metric (UniFrac, Lozupone & Knight 2005)

UniFrac √© uma m√©trica de dissimilaridade e determina a fra√ß√£o √∫nica da filogenia contida em cada uma das duas comunidades [@lozupone2005].

Abaixo, demonstramos os c√≥digos no R para o c√°lculo da UniFrac utilizando os dados das comunidades de aves.

```{r}
# An√°lise com dados de presen√ßa e aus√™ncia das esp√©cies nas comunidades.
resultados_UniFrac <- unifrac(composicao_especies,filogenia_aves)

```

## Vamos avaliar a correla√ß√£o entre Phylosor e Unifrac

```{r}

# Vamos criar um data.frame com os resultados das m√©tricas separados 
# para as dimens√µes de riqueza e diverg√™ncia.
metricas_riqueza_beta <- data.frame(Phylosor = as.numeric(resultados_Phylosor),
                       UniFrac = as.numeric(resultados_UniFrac))

# Gr√°fico.
ggpairs(metricas_riqueza_beta, upper=list(continuous = wrap("cor", size = 4)))
```

Os valores de Phylosor e UniFrac apresenta 99% de correla√ß√£o entre eles. Portanto, essas duas m√©tricas identificam padr√µes id√™nticos e n√£o devem ser utilizadas simultaneamente.

Gr√°ficos das m√©tricas da dimens√£o riqueza da diversidade beta filogen√©tica

```{r}
# Vamos inserir os dados de precipita√ß√£o na planilha metrica_riqueza_beta.
metricas_riqueza_beta$dis_prec <- as.numeric(dis_prec)

# Gr√°ficos.
# Phylosor.
plot_phylosor <- ggplot(metricas_riqueza_beta, aes(dis_prec, Phylosor)) +
        labs(x = "Diferen√ßa na precipita√ß√£o (mm)", 
             y = "Phylosor", size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        scale_y_continuous(limits = c(0, 1.0)) +
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        

# Unifrag.
plot_unifrac <- ggplot(metricas_riqueza_beta, aes(dis_prec, UniFrac)) +
        labs(x = "Diferen√ßa na precipita√ß√£o (mm)", 
             y = "UniFrac", size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        scale_y_continuous(limits = c(0, 1.0)) +
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        
ggarrange(plot_phylosor, plot_unifrac, ncol = 2)
```

Phylosor (similaridade) e UniFrac (dissimilaridade) foram relacionadas com o gradiente de precipita√ß√£o. Comunidades com quantidade de precipita√ß√£o parecidas abrigaram linhagens similares enquanto comunidades que recebem quantidade de precipita√ß√£o diferentes abrigam linhagens mais distintas.

## Parti√ß√£o da diversidade beta filogen√©tica

As m√©tricas, Phylosor e UniFrac, podem ser particionadas em dois componentes [@baselga2009; @leprieur2012]: i) substitui√ß√£o (do ingl√™s *turnover*) de esp√©cies entre as comunidades; e ii) componente de aninhamento que representa a perda ou ganho de esp√©cies entre comunidades atribu√≠dos a diferen√ßa na riqueza de esp√©cies. A parti√ß√£o da diversidade beta nestes componentes permite avaliar diferentes hip√≥teses sobre os processos e mecanismos atuando na montagem de comunidades.

Abaixo, demonstramos os c√≥digos no R para o c√°lculo da parti√ß√£o da diversidade beta filogen√©tica utilizando os dados das comunidades de aves.

```{r}
# Temos que transformar os dados para presen√ßa e aus√™ncia das esp√©cies 
# nas comunidades.
dados_PA <- decostand(composicao_especies, "pa")

# Parti√ß√£o dos componentes do Phylosor.
resultados_Phylosor_particao <- phylo.beta.pair(dados_PA,
                                                filogenia_aves, 
                                                index.family = "sorensen")

```

Vamos refazer a an√°lise para UniFrac.

```{r}
# Parti√ß√£o dos componentes do UniFrac.
resultados_UniFrac_particao <- phylo.beta.pair(dados_PA,
                                                filogenia_aves, 
                                                index.family = "jaccard")
# Resultado tem tr√™s matrizes: 
# i) dissimilaridade total (phylo.beta.jac); 
# ii) componente substitui√ß√£o de esp√©cies (phylo.beta.jtu); e 
# iii) componente aninhamento (phylo.beta.jne).
# resultados_UniFrac_particao (para ver os resultados corra este comando)
```


Gr√°fico com os resultados dos componentes substitui√ß√£o e aninhamento da diversidade beta filogen√©tica - Phylosor.

```{r}
# Vamos preparar os dados para o gr√°fico.
particao_phylosor <- data.frame(
      substituicao = as.numeric(resultados_Phylosor_particao$phylo.beta.sim),
      aninhamento = as.numeric(resultados_Phylosor_particao$phylo.beta.sne),
      sorensen = as.numeric(resultados_Phylosor_particao$phylo.beta.sor),
      dis_prec = as.numeric(dis_prec))

# Gr√°ficos.
sorensen_plot <- ggplot(particao_phylosor, 
                          aes(dis_prec, sorensen)) +
        labs(x = "", 
             y = "Sorensen") +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
         
subst_plot <- ggplot(particao_phylosor, 
                          aes(dis_prec, substituicao)) +
        labs(x = "Diferen√ßa na precipita√ß√£o\n (mm)", 
             y = "Componente Substitui√ß√£o", size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        
aninha_plot <- ggplot(particao_phylosor, 
                            aes(dis_prec, aninhamento)) +
        labs(x = "", 
             y = "Componente aninhamento", 
             size = 8) +
        geom_point(size = 4, shape = 19, col = "darkorange") + 
        tema_livro() +
        geom_smooth(method = lm, se = FALSE, color = "black") 
        
ggarrange(sorensen_plot, subst_plot, aninha_plot, 
          ncol = 3, nrow = 1)
dev.off()
```

Percebam que o componente substitui√ß√£o √© maior entre comunidades que apresentam diferen√ßas altas na quantidade de precipita√ß√£o, enquanto o componente aninhamento √© maior entre as comunidades que apresentam quantidade similar de precipita√ß√£o.

## Modelos Nulos

Em muitos casos, os valores de diversidade filogen√©tica s√£o correlacionados com a riqueza de esp√©cies nas comunidades. Por exemplo, se um pesquisador relata que duas comunidades apresentam diferentes valores de PD, √© imposs√≠vel saber se esta diferen√ßa √© simplesmente porque elas t√™m diferentes valores de riqueza de esp√©cies ou se h√° algum fator fundamental sobre a informa√ß√£o filogen√©tica que √© importante. Outra quest√£o abordada nos estudos de montagem das comunidades √© saber se os valores observados para as m√©tricas (e.g. MPD ou MNTD) relacionadas com a estrutura filogen√©tica das comunidades seriam diferentes se a coloniza√ß√£o das esp√©cies do pool regional fosse aleat√≥ria? Os modelos nulos respondem estas perguntas. Contudo, a defini√ß√£o do pool regional n√£o √© uma tarefa trivial [@lessard2012; @carstensen2013].

Os modelos nulos s√£o constru√≠dos considerando processos ecol√≥gicos ou evolutivos de interesse. Eles geram padr√µes que s√£o baseados na aleatoriza√ß√£o dos dados ecol√≥gicos ou amostragens aleat√≥rias de uma distribui√ß√£o conhecida ou hip√≥tetica [@gotelli1996]. Neste caso, alguns elementos dos dados (como colunas ou linhas) s√£o mantidos constantes, e outros s√£o permitidos variar aleatoriamente para criar novos padr√µes. O principal motivo para a constru√ß√£o de modelos nulos √© produzir um padr√£o que seria esperado na aus√™ncia de um mecanismo ecol√≥gico espec√≠fico [@gotelli1996]. Contudo, ressaltamos que os modelos nulos podem revelar padr√µes n√£o comuns, mas eles n√£o podem determinar os mecanismos respons√°veis por gerar estes padr√µes [@gotelli1996].

Os modelos nulos empregados para contrapor os padr√µes observados pelas m√©tricas de diversidade filogen√©tica utilizam a aleatoriza√ß√£o dos dados de duas formas principais: i) aleatorizando o nome das esp√©cies na √°rvore filogen√©tica mantendo a estrutura e composi√ß√£o da matriz de co-ocorr√™ncia das esp√©cies e o comprimento dos ramos da √°rvore inalterados; e ii) aleatorizando as linhas e/ou colunas da matriz de co-ocorr√™ncia das esp√©cies [@gotelli2000; @ulrich2010]. De forma geral, nas an√°lises de diversidade filogen√©tica as aleatoriza√ß√µes s√£o repetidas 999 vezes (pode ser mais ou menos a crit√©rio do pesquisador) e calcula-se a m√©dia e o desvio padr√£o dos valores gerados pelo modelos. Com estes dados, calcula-se o tamanho do efeito padronizado (do ingl√™s Standardized Effect Size - SES) utilizando a seguinte f√≥rmula:

> SES = (valor observado - m√©dia dos valores gerados na aleatoriza√ß√£o)/ desvio padr√£o dos valores gerados na aleatoriza√ß√£o

Os valores de SES s√£o utilizados para rejeitar ou n√£o a hip√≥tese nula de que o padr√£o observado difere do esperado pelo acaso. Contudo, tenha em mente que a defini√ß√£o do esquema de aleatoriza√ß√£o dos modelos nulos n√£o √© meramente uma quest√£o t√©cnica [@g√∂tzenberger2011]. A defini√ß√£o do esquema de aleatoriza√ß√£o ir√° determinar quais os mecanismos ecol√≥gicos s√£o permitidos ou exclu√≠dos no modelo nulo [@g√∂tzenberger2011]. Consequentemente, ele estar√° avaliando diferentes hip√≥teses nulas.

Abaixo, demonstramos os c√≥digos no R para calcular os modelos nulos para as m√©tricas de diversidade filogen√©tica.

## Nearest Relative Index (NRI) ou Standardized Effect Size of MPD (Webb et al. 2008)

Esta m√©trica calcula o tamanho do efeito padronizado para a m√©trica MPD. Contudo, NRI √© calculado multiplicando os resultados do SES por -1. Valores positivos de NRI indicam agrupamento filogen√©tico e valores negativos de NRI indicam dispers√£o filogen√©tica.

```{r}
# NRI ou SES_MPD. 
resultados_SES_MPD <- ses.mpd(composicao_especies, cophenetic(filogenia_aves),
                              null.model = "taxa.labels", 
                              abundance.weighted = FALSE,
                              runs = 999) 

# Mostra a riqueza de esp√©ices,MPD observado, m√©dia e desvio padr√£o dos 
# valores de MPD das aleatoriza√ß√µes, SES e o valor de p.
head(resultados_SES_MPD)
```

Veja a ajuda destea fun√ß√£o usando`?ses.mpd` para ver todas as possibilidades de modelos nulos dispon√≠veis.

## Nearest Taxon Index (NTI) ou Standardized Effect Size of MNTD (Webb et al. 2008)

Esta m√©trica calcula o tamanho do efeito padronizado para a m√©trica MNTD. Contudo, NTI √© calculado multiplicando os resultados do SES por -1. Valores positivos de NTI indicam agrupamento filogen√©tico e valores negativos de NTI indicam dispers√£o filogen√©tica.

```{r}
# NTI ou SES_MNTD. 
resultados_SES_MNTD <- ses.mntd(composicao_especies, cophenetic(filogenia_aves),
                              null.model = "taxa.labels", 
                              abundance.weighted = FALSE,
                              runs = 999) 

# Mostra a riqueza de esp√©ices,MNTD observado, m√©dia e desvio padr√£o dos 
# valores de MNTD das aleatoriza√ß√µes, SES e o valor de p.
head(resultados_SES_MNTD)
```

## Standardized Effect Size of PD (Webb et al. 2008)

Esta m√©trica calcula o tamanho do efeito padronizado para a m√©trica PD.

```{r}
# SES_PD. 
resultados_SES_PD <- ses.pd(composicao_especies, filogenia_aves,
                              null.model = "independentswap", 
                              runs = 999) 

# Mostra a riqueza de esp√©ices,MNTD observado, m√©dia e desvio padr√£o dos 
# valores de PD das aleatoriza√ß√µes, SES e o valor de p.
head(resultados_SES_PD) 
```

## Standardized Effect Size

N√£o h√° pacotes que calculam o SES para a m√©trica Phylosor. Assim, iremos usar a fun√ß√£o `phylosor.rnd()`para criar modelos nulos para o Physolor, e em seguida, iremos usar uma fun√ß√£o para calcular os valores de SES e os valores de P.

```{r}
# Modelo nulo que rearranja o nome das esp√©cies na filogenia. 
modelos_nulo <- phylosor.rnd(composicao_especies, filogenia_aves, 
                             null.model = "taxa.labels", runs = 9)

# Fun√ß√£o para calcular o SES eo valor de P.
ses.physo <- function(obs, nulo_phylosor){
  nulo_phylosor <- t(as.data.frame(lapply
			(nulo_phylosor, as.vector)))
  physo.obs <- as.numeric(obs)
  physo.mean <- apply(nulo_phylosor, MARGIN = 2, 
	FUN = mean, na.rm = TRUE)
  physo.sd <- apply(nulo_phylosor, MARGIN = 2, 
	FUN = sd, na.rm = TRUE)
  physo.ses <- (physo.obs - physo.mean)/physo.sd
  physo.obs.rank <- apply(X = rbind(physo.obs, 
		nulo_phylosor), MARGIN = 2, 
		FUN = rank)[1, ]
  physo.obs.rank <- ifelse(is.na(physo.mean), NA, 
				physo.obs.rank)
  data.frame(physo.obs, physo.mean, physo.sd, 
		physo.obs.rank, physo.ses, 
		physo.obs.p = physo.obs.rank/
		(dim(nulo_phylosor)[1] + 1))
}

resultados <- ses.physo (resultados_Phylosor, modelos_nulo)
head(resultados)
```

### Para se aprofundar

-   Recomendamos aos interessados os livros: i) Swenson [-@swenson2014] Functional and Phylogenetic Ecology in R; ii) Paradis [-@paradis2012] Analysis of Phylogenetics and Evolution in R; iii) Cadotte & Davies [-@cadotte2016] Phylogenies in Ecology, iv) Gotelli & Graves [-@gotelli1996] Null Models in Ecology; e v) Magurran & McGill [-@magurran_biological_2011] Biological Diversity Frontiers in Measurement and Assessment.

